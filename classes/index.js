const agencies = [
  {
    agencyName: "Best Deal",
    cash: 1245000,
    credit: 200000,
    agencyId: "Plyq5M5AZ",

    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "3",
            year: 2015,
            price: 137000,
            carNumber: "AZJZ4",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "X6",
            year: 2020 ,
            price: 966500,
            carNumber: "S6DL1",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2020,
            price: 336300,
            carNumber: "6rvXw",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Hilux",
            year: 2005,
            price: 35005,
            carNumber: "MWXBG",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Corolla",
            year: 2020,
            price: 111900,
            carNumber: "hCzl-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Focus",
            year: 2020,
            price: 98200,
            carNumber: "kN3HP",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Focus",
            year: 2005,
            price: 6502,
            carNumber: "LJTCs",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Romeo Julia",
            year: 2020,
            price: 275406,
            carNumber: "2kjy7",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Romeo Stelvio",
            year: 2019,
            price: 215403,
            carNumber: "7A5b-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Traverse",
            year: 2020,
            price: 201102,
            carNumber: "QwBOT",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Impala",
            year: 2019,
            price: 165041,
            carNumber: "2v4jt",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Malibu",
            year: 2017,
            price: 75405,
            carNumber: "O4_Jv",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
    ],
  },
  {
    agencyName: "CarMax",
    cash: 968541,
    credit: 500000,
    agencyId: "26_IPfHU1",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X5",
            year: 2015,
            price: 218000,
            carNumber: "4Ixb0",
            ownerId: "26_IPfHU1",
          },
          {
            name: "X6",
            year: 2014,
            price: 97100,
            carNumber: "kAnv-",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Z4",
            year: 2019,
            price: 296900,
            carNumber: "ISMdU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "3",
            year: 2010,
            price: 75100,
            carNumber: "9DJPw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2005,
            price: 80540,
            carNumber: "Kt-pW",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Corolla",
            year: 2019,
            price: 109100,
            carNumber: "YiYdI",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Hilux",
            year: 2019,
            price: 204000,
            carNumber: "DRmNw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "F250",
            year: 2020,
            price: 198500,
            carNumber: "g4Wfp",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Explorer",
            year: 2020,
            price: 265200,
            carNumber: "iNT8Q",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Spider",
            year: 2011,
            price: 75405,
            carNumber: "6t7QU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "166",
            year: 2002,
            price: 12400,
            carNumber: "XMqpn",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2016,
            price: 65042,
            carNumber: "vbeAo",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Savannah",
            year: 2016,
            price: 76505,
            carNumber: "WelWa",
            ownerId: "26_IPfHU1",
          },
        ],
      },
    ],
  },
  {
    agencyName: "The Auto World",
    cash: 687450,
    credit: 200000,
    agencyId: "gNHjNFL12",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X6",
            year: 2018,
            price: 548100,
            carNumber: "EMW_7",
            ownerId: "gNHjNFL12",
          },
          {
            name: "3",
            year: 2017,
            price: 178000,
            carNumber: "XlnB4",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2017,
            price: 101542,
            carNumber: "-RQgN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Highlander",
            year: 2017,
            price: 202540,
            carNumber: "AZJZ4",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 1996,
            price: 5420,
            carNumber: "kHE8f",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 2012,
            price: 40570,
            carNumber: "p2qEi",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Explorer",
            year: 2014,
            price: 127502,
            carNumber: "Ty1zN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "F350",
            year: 2012,
            price: 54250,
            carNumber: "z03H2",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Savannah",
            year: 2010,
            price: 36504,
            carNumber: "RXFZe",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Malibu",
            year: 2009,
            price: 19585,
            carNumber: "K5IsM",
            ownerId: "gNHjNFL12",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Car Werks",
    cash: 302502,
    credit: 150000,
    agencyId: "9KeaYbRLP",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "8",
            year: 2020,
            price: 942500,
            carNumber: "4IUMz",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X6",
            year: 2010,
            price: 129000,
            carNumber: "Vw0fV",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X3",
            year: 2019,
            price: 358100,
            carNumber: "ufN54",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2020,
            price: 389100,
            carNumber: "F127X",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2002,
            price: 18400,
            carNumber: "ueZUp",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2011,
            price: 38520,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Land Cruiser",
            year: 2019,
            price: 290040,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2020,
            price: 215700,
            carNumber: "xig8N",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2015,
            price: 178506,
            carNumber: "ghTiQ",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Corolla",
            year: 2002,
            price: 8504,
            carNumber: "Mvw8T",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2005,
            price: 9320,
            carNumber: "BZpkt",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Malibu",
            year: 2002,
            price: 4502,
            carNumber: "KqKV_",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Carsova",
    cash: 72450,
    credit: 50000,
    agencyId: "oqQmsZoUo",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "7",
            year: 1999,
            price: 24700,
            carNumber: "sZrjp",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "3",
            year: 2008,
            price: 54000,
            carNumber: "da88K",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2019,
            price: 124050,
            carNumber: "ZfbqH",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "Hilux",
            year: 1996,
            price: 11540,
            carNumber: "AZJZ4",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
    ],
  },
];

const customers = [
  {
    name: "Lilah Goulding",
    id: "BGzHhjnE8",
    cars: [
      {
        name: "Corolla",
        year: 2013,
        price: 40570,
        carNumber: "16da1",
        ownerId: "BGzHhjnE8",
      },
    ],
    cash: 35000,
  },
  {
    name: "Ravi Murillo",
    id: "2RprZ1dbL",
    cars: [
      {
        name: "M5",
        year: 2019,
        price: 578054,
        carNumber: "WIh0U",
        ownerId: "2RprZ1dbL",
      },
      {
        name: "Spider",
        year: 2012,
        price: 81520,
        carNumber: "RLS4q",
        ownerId: "2RprZ1dbL",
      },
    ],
    cash: 278542,
  },
  {
    name: "Aleksander Carr",
    id: "pAuFtn_WA",
    cars: [
      {
        name: "Highlander",
        year: 2018,
        price: 214503,
        carNumber: "2WU_y",
        ownerId: "pAuFtn_WA",
      },
    ],
    cash: 125402,
  },
  {
    name: "Lana Edge",
    id: "cnTobUDy6",
    cars: [
      {
        name: "F250",
        year: 2020,
        price: 198500,
        carNumber: "Xxcy_",
        ownerId: "cnTobUDy6",
      },
      {
        name: "Hilux",
        year: 2005,
        price: 35005,
        carNumber: "VSCUj",
        ownerId: "cnTobUDy6",
      },
    ],
    cash: 7000,
  },
  {
    name: "Nikita Philip",
    id: "5x2tMcX4R",
    cars: [
      {
        name: "Impala",
        year: 2016,
        price: 65042,
        carNumber: "LKInp",
        ownerId: "5x2tMcX4R",
      },
    ],
    cash: 40541,
  },
  {
    name: "Bob Steel",
    id: "Wm6BkA1F0",
    cars: [],
    cash: 15732,
  },
  {
    name: "Will Reyes",
    id: "FQvNsEwLZ",
    cars: [
      { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
      {
        name: "Land Cruiser",
        year: 2020,
        price: 336300,
        carNumber: "vaJvd",
        ownerId: "FQvNsEwLZ",
      },
      {
        name: "Romeo Julia",
        year: 2020,
        price: 275406,
        carNumber: "qLoYR",
        ownerId: "FQvNsEwLZ",
      },
      {
        name: "Explorer",
        year: 2020,
        price: 265200,
        carNumber: "tlGRq",
        ownerId: "FQvNsEwLZ",
      },
    ],
    cash: 1547242,
  },
];

class CarAgencyManager {
	constructor(agencies) {
		this.agencies = agencies;
	}

//Search Car And Give The Brand And Index
searchCarIndex(id, agency){
  let theCar = [];
  for (const carBrand of agency.cars) {
    carBrand.models.find((car, index) => {
      if (car.carNumber === id) {
          theCar = [carBrand.brand,index];
        }
    });
    }
    return theCar.length !== 0 ? theCar : false;
  }

  
  //Total Funds In An Agency
  checkTotalAgencyFunds(agency){
    return agency.cash + agency.credit;
  }


  //Search Agency
	searchAgency(idOrName) {
    const find = this.agencies.find((agency) => agency.agencyName === idOrName || agency.agencyId === idOrName);
    return find ? find : null;
  }


  //Get All Agencies
	getAllAgencies() {
    const allAgencies = this.agencies.map((agency)=>agency.agencyName);
    return allAgencies;
  }


  //Add A Car To An Agency
  addCarToAgency(id, newCar) {   
    const agency = this.searchAgency(id);
    if (!agency) return false;
    
    const brand = agency.cars.find((car) => car.brand === newCar.brand);
      
    if (brand){
      brand.models.push(...newCar.models);
      return true;
    }
    else{
      agency.cars.push(newCar);
      return true;
    }
  }


  // Remove A Car From An Agency
	removeCarFromAgency(id, carId) {
    let carRemoved = false;

    const agency = this.searchAgency(id);
    if(!agency) return false;

    const theCar = this.searchCarIndex(carId,agency);
    if(!theCar) return false;

    const [carBrand,index] = theCar;

    agency.cars.forEach( brands => {
      if (brands.brand === carBrand) {
        brands.models.splice(index,1);
        carRemoved = true; 
      }
    });
    return carRemoved;
  }


  //Change The Amount Of Cash And Credit In An Agency
	changeAgencyCashOrCredit(agencyId, cashOrCredit) {
    if (typeof cashOrCredit !== `number`) {
        return false;
    }

    const agency = this.searchAgency(agencyId);
    if(!agency) return false;

    if (cashOrCredit < 0) {
      if (Math.abs(cashOrCredit) > agency.cash) {
        agency.credit = this.checkTotalAgencyFunds(agency) + cashOrCredit;
        agency.cash = 0;
      }
      else{
        agency.cash = agency.cash + cashOrCredit;
      }
      return true;
    }
    else{
      agency.cash += cashOrCredit;
       return true;
    }
  }

	// @return {boolean} - true if updated successfully, false otherwise
	updateCarPrice(agencyId, carId, newPrice) {
    const agency = this.searchAgency(agencyId);
    if(!agency) return false;

    const theCar = this.searchCarIndex(carId,agency)
    if(!theCar) return false;

    const [carBrand, carIndex] = theCar;

    agency.cars.forEach((brands) => {
      if (brands.brand === carBrand) {
        brands.models[carIndex].price = newPrice;
      }
    })
    return true;
  }

  // Get The Total Funds In an Agency Using ID
	getTotalAgencyRevenue(agencyId) {
    const agency = this.searchAgency(agencyId);
    if(!agency) return false;

    return this.checkTotalAgencyFunds (agency);
  }


  //Transfer A Car - Copy Car/Delete Car/Paste Car
	transferCarBetweenAgencies(fromAgencyId, toAgencyId, carId) {

    const carCopy = this.copyCarObject(fromAgencyId,carId);
    const remove = this.removeCarFromAgency(fromAgencyId,carId);
    const add = this.addCarToAgency(toAgencyId,carCopy);
    
    if (!carCopy || !remove || !add) {
      return false;
    }
    return true;
  }


    //Copy A Car
    copyCarObject(id, carId){
      const agency = this.searchAgency(id);
      if(!agency) return false;

      let carCopy = {brand: null, models: []};

      agency.cars.forEach((brands) => {
      brands.models.find((car) => {
          if (car.carNumber === carId) {
             carCopy.brand = brands.brand;
             carCopy.models.push({...car});
            }
        })
      })
      return carCopy;
    }
}




class CustomerManager {
	constructor(customers) {
		this.customers = customers;
	}

  //Search For A Customer By ID or Name
	searchCustomer(idOrName) {
    const findCustomer = this.customers.find((customer) => customer.name === idOrName || customer.id === idOrName)
    return findCustomer ? findCustomer : null;
  }










	// Retrieve all customers' names.
	// @return {string[]} - Array of customer names
	getAllCustomers() {}

	// Change the cash of a customer.
	// @param {string} customerId - The ID of the customer
	// @param {number} cash - The new cash value
	// @return {boolean} - true if updated successfully, false otherwise
	changeCustomerCash(customerId, cash) {}

	// Calculate the total value of all cars owned by a specific customer.
	// @param {string} customerId - The ID of the customer
	// @return {number} - The total value of cars owned by the customer
	getCustomerTotalCarValue(customerId) {}
}

class CarManager {
	constructor(agencies) {
		this.agencies = agencies;
	}

	// Retrieve all cars available for purchase.
	// @return {object[]} - Array of cars
	getAllCars() {}

	// Search for cars based on certain criteria.
	// @param {number} year - The production year of the car
	// @param {number} price - The price of the car
	// @param {string} brand - The brand of the car
	// @return {object[]} - Array of cars that meet the criteria
	searchCars(year, price, brand) {}

	// Return the most expensive car available for sale.
	// @return {object} - The most expensive car
	getMostExpensiveCar() {}

	// Return the cheapest car available for sale.
	// @return {object} - The cheapest car
	getCheapestCar() {}
}

class CarPurchaseManager {
	constructor(agencies, customers) {
		this.agencies = agencies;
		this.customers = customers;
		this.taxesAuthority = {
			totalTaxesPaid: 0,
			sumOfAllTransactions: 0,
			numberOfTransactions: 0,
		};
	}

	// Sell a car to a specific customer.
	// @param {string} carId - The ID of the car
	// @param {string} customerId - The ID of the customer
	// @return {boolean} - true if the car was sold successfully, false otherwise
	sellCar(carId, customerId) {}

	// Calculate and return the total revenue of the entire market.
	// @return {number} - The total revenue of the market
	getTotalMarketRevenue() {}
}

// Car Agency Manager Tests
const carAgencyManager = new CarAgencyManager(agencies);



console.log(`-------------------------------------------------------------------`);





// // Test searchAgency
console.log('Search Agency by ID: ', carAgencyManager.searchAgency('Plyq5M5AZ'));
console.log('Search Agency by Name: ', carAgencyManager.searchAgency('Best Deal'));
console.log('Search Agency Non-existent: ', carAgencyManager.searchAgency('NonExistent'));





console.log(`-------------------------------------------------------------------`);





// // Test getAllAgencies
console.log('All Agencies: ', carAgencyManager.getAllAgencies());





console.log(`-------------------------------------------------------------------`);


// // Test addCarToAgencyconsole.log

const newCar = {
  brand: 'toyota',
  models: [{
    name: 'Camry',
    year: 2021,
    price: 30000,
    carNumber: 'TEST1',
    ownerId: 'Plyq5M5AZ',
  }],
};

console.log('Add Car to Agency: ', carAgencyManager.addCarToAgency('Plyq5M5AZ', newCar));



console.log(`-------------------------------------------------------------------`);




// // Test removeCarFromAgency
console.log('Remove Car from Agency: ', carAgencyManager.removeCarFromAgency('Plyq5M5AZ', 'TEST1'));
console.log('Remove Non-existent Car: ', carAgencyManager.removeCarFromAgency('Plyq5M5AZ', 'NonExistent'));




console.log(`-------------------------------------------------------------------`);




// // Test changeAgencyCashOrCredit
console.log('Change Agency Cash: ', carAgencyManager.changeAgencyCashOrCredit('Plyq5M5AZ', 2000000));
console.log('Change Agency Cash (Invalid): ', carAgencyManager.changeAgencyCashOrCredit('Plyq5M5AZ', 'invalid'));





console.log(`-------------------------------------------------------------------`);



// // Test updateCarPrice
console.log('Update Car Price: ', carAgencyManager.updateCarPrice('Plyq5M5AZ', 'AZJZ4', 150000));
console.log('Update Car Price Non-existent: ', carAgencyManager.updateCarPrice('Plyq5M5AZ', 'NonExistent', 150000));




console.log(`-------------------------------------------------------------------`);






// // Test getTotalAgencyRevenue
console.log('Total Agency Revenue: ', carAgencyManager.getTotalAgencyRevenue('Plyq5M5AZ'));






console.log(`-------------------------------------------------------------------`);





// // Test transferCarBetweenAgencies
console.log('Transfer Car Between Agencies: ', carAgencyManager.transferCarBetweenAgencies('Plyq5M5AZ', '26_IPfHU1', 'AZJZ4'));
console.log('Transfer Car Between Agencies (Non-existent): ', carAgencyManager.transferCarBetweenAgencies('NonExistent', '26_IPfHU1', 'AZJZ4'));





console.log(`-------------------------------------------------------------------`);




// // Customer Manager Tests
const customerManager = new CustomerManager(customers);


// // Test searchCustomer
console.log('Search Customer by ID: ', customerManager.searchCustomer('BGzHhjnE8'));
console.log('Search Customer by Name: ', customerManager.searchCustomer('Lilah Goulding'));
console.log('Search Customer Non-existent: ', customerManager.searchCustomer('NonExistent'));





console.log(`-------------------------------------------------------------------`);


// // Test getAllCustomers
// console.log('All Customers: ', customerManager.getAllCustomers());

// // Test changeCustomerCash
// console.log('Change Customer Cash: ', customerManager.changeCustomerCash('BGzHhjnE8', 50000));
// console.log('Change Customer Cash Non-existent: ', customerManager.changeCustomerCash('NonExistent', 50000));

// // Test getCustomerTotalCarValue
// console.log('Customer Total Car Value: ', customerManager.getCustomerTotalCarValue('BGzHhjnE8'));
// console.log('Customer Total Car Value Non-existent: ', customerManager.getCustomerTotalCarValue('NonExistent'));

// // Car Manager Tests
// const carManager = new CarManager(agencies);

// // Test getAllCars
// console.log('All Cars: ', carManager.getAllCars());

// // Test searchCars
// console.log('Search Cars: ', carManager.searchCars(2020, 500000, 'bmw'));
// console.log('Search Cars (No Brand): ', carManager.searchCars(2020, 500000));

// // Test getMostExpensiveCar
// console.log('Most Expensive Car: ', carManager.getMostExpensiveCar());

// // Test getCheapestCar
// console.log('Cheapest Car: ', carManager.getCheapestCar());

// // Car Purchase Manager Tests
// const carPurchaseManager = new CarPurchaseManager(agencies, customers);

// // Test sellCar
// console.log('Sell Car: ', carPurchaseManager.sellCar('AZJZ4', 'BGzHhjnE8'));
// console.log('Sell Car (Non-existent): ', carPurchaseManager.sellCar('NonExistent', 'BGzHhjnE8'));
// console.log('Sell Car (Insufficient Funds): ', carPurchaseManager.sellCar('AZJZ4', 'Wm6BkA1F0'));

// // Test getTotalMarketRevenue
// console.log('Total Market Revenue: ', carPurchaseManager.getTotalMarketRevenue());
